<!DOCTYPE html>
<html lang="en" class="antialiased">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Finance Dashboard</title>
    <script> tailwind.config = { darkMode: 'class' } </script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        .fade-in {animation: fadeIn 0.6s;}
        .slide-up {animation: slideUp 0.5s;}
        .hover-lift {transition: transform 0.3s;}
        .hover-lift:hover {transform: translateY(-3px);}
        @keyframes fadeIn {from{opacity:0;} to{opacity:1;}}
        @keyframes slideUp {from{transform:translateY(15px);opacity:0;} to{transform:translateY(0);opacity:1;}}
    </style>
</head>
<body class="bg-gray-50 dark:bg-gray-900 text-gray-800 dark:text-gray-100">
    <div class="min-h-screen flex">
        <aside class="w-64 bg-white dark:bg-gray-800 shadow-lg px-6 py-8 slide-up">
            <div class="flex items-center gap-3 mb-8">
                <div class="w-10 h-10 bg-indigo-600 rounded-lg flex items-center justify-center text-white font-bold">ET</div>
                <div>
                    <div class="text-lg font-semibold">Expense Tracker</div>
                    <div class="text-xs text-gray-500 dark:text-gray-400">Personal Finance</div>
                </div>
            </div>
            <nav class="space-y-1">
                <a href="transactions.html" class="block px-3 py-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700">Transactions</a>
                <a href="dashboard.html" class="block px-3 py-2 rounded-lg bg-indigo-50 text-indigo-600 dark:bg-indigo-700/20 dark:text-indigo-200 font-medium">Dashboard</a>
                <a href="settings.html" class="block px-3 py-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700">Settings</a>
                <a href="#" onclick="logout()" class="block px-3 py-2 rounded-lg hover:bg-red-100 dark:hover:bg-red-700 text-red-600 dark:text-red-400 font-medium mt-4 border-t pt-2 border-gray-100 dark:border-gray-700">Logout</a>
            </nav>
            <div class="mt-8 text-sm text-gray-500 dark:text-gray-400">
                <div>Logged in as</div>
                <div id="loggedInUsername" class="font-medium mt-1">Ayman</div>
            </div>
        </aside>

        <main class="flex-1 p-8 space-y-10">
            <section class="space-y-6 slide-up">
                <h2 class="text-2xl font-bold">Summary</h2>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div class="p-6 bg-white dark:bg-gray-800 rounded-xl shadow hover-lift fade-in" style="animation-delay:0.1s">
                        <h3 class="text-gray-500">Total Income</h3>
                        <p id="totalIncome" class="text-3xl font-bold text-green-600">$0</p>
                    </div>
                    <div class="p-6 bg-white dark:bg-gray-800 rounded-xl shadow hover-lift fade-in" style="animation-delay:0.2s">
                        <h3 class="text-gray-500">Total Expenses</h3>
                        <p id="totalExpenses" class="text-3xl font-bold text-red-600">$0</p>
                    </div>
                    <div class="p-6 bg-white dark:bg-gray-800 rounded-xl shadow hover-lift fade-in" style="animation-delay:0.3s">
                        <h3 class="text-gray-500">Balance</h3>
                        <p id="balance" class="text-3xl font-bold text-indigo-600">$0</p>
                    </div>
                </div>
            </section>

            <section class="space-y-6 slide-up" style="animation-delay:0.2s">
                <div class="flex items-center justify-between">
                    <h2 class="text-2xl font-bold">Charts</h2>
                    <div class="flex gap-2 text-sm">
                        <div class="flex items-center gap-1"><div class="w-3 h-3 bg-green-500 rounded-full"></div><span>Income</span></div>
                        <div class="flex items-center gap-1"><div class="w-3 h-3 bg-red-500 rounded-full"></div><span>Expenses</span></div>
                    </div>
                </div>
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow hover-lift">
                        <div class="flex items-center justify-between mb-6">
                            <h3 class="text-lg font-semibold">Income vs Expenses</h3>
                            <div class="text-sm text-gray-500" id="pieChartRatio">0:0</div>
                        </div>
                        <div class="h-64">
                            <canvas id="pieChart"></canvas>
                        </div>
                        <div class="mt-6 grid grid-cols-2 gap-4">
                            <div class="text-center p-3 bg-green-50 dark:bg-green-900/20 rounded-lg">
                                <div class="text-sm text-gray-600">Total Income</div>
                                <div id="incomeAmount" class="text-xl font-bold text-green-600">$0</div>
                            </div>
                            <div class="text-center p-3 bg-red-50 dark:bg-red-900/20 rounded-lg">
                                <div class="text-sm text-gray-600">Total Expenses</div>
                                <div id="expenseAmount" class="text-xl font-bold text-red-600">$0</div>
                            </div>
                        </div>
                    </div>
                    <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow hover-lift">
                        <div class="flex items-center justify-between mb-6">
                            <h3 class="text-lg font-semibold">Monthly Overview</h3>
                            <select id="chartRange" class="text-sm border border-gray-300 dark:border-gray-600 rounded-lg px-3 py-1 bg-transparent">
                                <option value="3">Last 3 months</option>
                                <option value="6" selected>Last 6 months</option>
                                <option value="12">Last 12 months</option>
                            </select>
                        </div>
                        <div class="h-64">
                            <canvas id="barChart"></canvas>
                        </div>
                        <div class="mt-4 text-center text-sm text-gray-500" id="highestMonth">Highest: No data</div>
                    </div>
                </div>
            </section>
        </main>
    </div>

<script>
// البيانات
let transactions = JSON.parse(localStorage.getItem('transactions') || '[]');
let totalIncome = 0, totalExpenses = 0;

// حساب الإجماليات
transactions.forEach(t => {
    if (t.type === 'Income') totalIncome += parseFloat(t.amount) || 0;
    else totalExpenses += parseFloat(t.amount) || 0;
});

// تحديث البطاقات مع أنيميشن
function animateValue(id, end) {
    const el = document.getElementById(id);
    let start = 0, duration = 800;
    const step = (timestamp) => {
        if (!start) start = timestamp;
        const progress = Math.min((timestamp - start) / duration, 1);
        const val = progress * end;
        el.textContent = '$' + val.toFixed(2);
        if (progress < 1) requestAnimationFrame(step);
        else el.textContent = '$' + end.toFixed(2);
    };
    requestAnimationFrame(step);
}

// تحديث البطاقات
animateValue('totalIncome', totalIncome);
animateValue('incomeAmount', totalIncome);
animateValue('totalExpenses', totalExpenses);
animateValue('expenseAmount', totalExpenses);
animateValue('balance', totalIncome - totalExpenses);

// تحديث النسبة
const ratio = totalExpenses > 0 ? (totalIncome / totalExpenses).toFixed(2) : "∞";
document.getElementById('pieChartRatio').textContent = `${ratio}:1`;

// الرسم البياني الدائري
new Chart(document.getElementById('pieChart'), {
    type: 'doughnut',
    data: {
        labels: ['Income', 'Expenses'],
        datasets: [{
            data: [totalIncome, totalExpenses],
            backgroundColor: ['#10B981', '#EF4444'],
            borderWidth: 2
        }]
    },
    options: {
        responsive: true,
        maintainAspectRatio: false,
        cutout: '65%',
        animation: {duration: 1500}
    }
});

// الرسم البياني الشريطي
let barChart;
const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];

function updateBarChart(monthCount = 6) {
    const monthlyIncome = new Array(12).fill(0);
    const monthlyExpenses = new Array(12).fill(0);
    const now = new Date();
    const currentMonth = now.getMonth();

    transactions.forEach(t => {
        const date = new Date(t.date);
        const month = date.getMonth();
        let monthDiff = (currentMonth - month + 12) % 12;
        if (monthDiff < monthCount) {
            if (t.type === 'Income') monthlyIncome[month] += parseFloat(t.amount) || 0;
            else monthlyExpenses[month] += parseFloat(t.amount) || 0;
        }
    });

    const displayMonths = [];
    const displayIncome = [];
    const displayExpenses = [];
    
    for (let i = 0; i < monthCount; i++) {
        const idx = (currentMonth - i + 12) % 12;
        displayMonths.unshift(months[idx]);
        displayIncome.unshift(monthlyIncome[idx]);
        displayExpenses.unshift(monthlyExpenses[idx]);
    }

    let maxValue = 0;
    let highestMonthIndex = -1;
    
    for (let i = 0; i < monthCount; i++) {
        const total = displayIncome[i] + displayExpenses[i];
        if (total > maxValue) {
            maxValue = total;
            highestMonthIndex = i;
        }
    }

    document.getElementById('highestMonth').textContent = 
        highestMonthIndex !== -1 && maxValue > 0 
        ? `Highest: ${displayMonths[highestMonthIndex]} ($${maxValue.toFixed(2)})`
        : 'Highest: No data';

    const ctx = document.getElementById('barChart');
    if (barChart) barChart.destroy();
    
    barChart = new Chart(ctx, {
        type: 'bar',
        data: {
            labels: displayMonths,
            datasets: [
                {
                    label: 'Income',
                    data: displayIncome,
                    backgroundColor: '#10B981',
                    borderRadius: 4
                },
                {
                    label: 'Expenses',
                    data: displayExpenses,
                    backgroundColor: '#EF4444',
                    borderRadius: 4
                }
            ]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
                y: {
                    beginAtZero: true,
                    ticks: { callback: v => '$' + v }
                }
            },
            animation: {duration: 1500}
        }
    });
}

// تحديث الرسم البياني
document.getElementById('chartRange').addEventListener('change', function() {
    updateBarChart(parseInt(this.value));
});

// تهيئة
updateBarChart(6);

// تسجيل الخروج
function logout() {
    localStorage.removeItem('currentUser');
    window.location.href = 'index.html';
}

// تحديث اسم المستخدم
const user = JSON.parse(localStorage.getItem('currentUser') || '{}');
if (user.username) document.getElementById('loggedInUsername').textContent = user.username;
</script>
</body>
</html>